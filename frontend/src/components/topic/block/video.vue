<template>
  <div v-if="!activated" class="play-video-wrapper">
    <div v-bind="wrapperProps">
      <BImg :src="posterUrl" />
    </div>
    <BButton variant="primary" class="play-video-button" @click.prevent="onActivate">
      <VespFa icon="play" style="width: 3rem; height: 3rem" fixed-width />
    </BButton>
  </div>
  <div v-else v-bind="wrapperProps">
    <PlayerVideo :uuid="block.data.uuid" :autoplay="true" :poster="posterUrl" />
  </div>
  <PlayerAudio v-if="useAudio && block.data.audio" :uuid="block.data.audio" :title="$t('models.video.audio')" />
</template>

<script setup lang="ts">
import type {OutputBlockData} from '@editorjs/editorjs'

const useAudio = Number(useRuntimeConfig().public.EXTRACT_VIDEO_AUDIO_ENABLED)
const props = defineProps({
  block: {
    type: Object as PropType<OutputBlockData>,
    required: true,
  },
  maxWidth: {
    type: Number,
    default: 800,
  },
})

const posterUrl = getApiUrl() + 'poster/' + props.block.data.uuid + '/' + props.maxWidth
const activated = ref(false)
const wrapperProps = computed(() => {
  return {
    class: ['ratio', 'ratio-16x9', 'm-auto', 'rounded'],
    style: {maxWidth: props.maxWidth + 'px'},
  }
})

function onActivate() {
  activated.value = true
}
</script>
